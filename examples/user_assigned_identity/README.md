<!-- BEGIN_TF_DOCS -->
<!-- Code generated by terraform-docs. DO NOT EDIT. -->
# User-Assigned Identity Example

This example demonstrates how to configure the backup vault with different managed identity types, including user-assigned identity.

```hcl
terraform {
  required_version = ">= 1.9, < 2.0"

  required_providers {
    azapi = {
      source  = "Azure/azapi"
      version = "~> 2.4"
    }
    azurerm = {
      source  = "hashicorp/azurerm"
      version = "~> 4.0"
    }
  }
}

provider "azurerm" {
  features {}
}

provider "azapi" {}

# Naming
module "naming" {
  source  = "Azure/naming/azurerm"
  version = "0.3.0"
}

# Resource Group
resource "azurerm_resource_group" "rg" {
  location = "centralus"
  name     = "${module.naming.resource_group.name_unique}-uai"
}

# Create User-Assigned Managed Identity
resource "azurerm_user_assigned_identity" "backup_vault_identity" {
  location            = azurerm_resource_group.rg.location
  name                = "${module.naming.user_assigned_identity.name_unique}-backup"
  resource_group_name = azurerm_resource_group.rg.name
}

# Backup Vault with User-Assigned Identity Only
module "backup_vault_user_assigned_only" {
  source = "../../"

  datastore_type      = "OperationalStore"
  location            = azurerm_resource_group.rg.location
  name                = "${module.naming.recovery_services_vault.name_unique}-uai"
  redundancy          = "LocallyRedundant"
  resource_group_name = azurerm_resource_group.rg.name
  diagnostic_settings = {}
  enable_telemetry    = true
  # User-Assigned Identity Only
  managed_identities = {
    system_assigned            = false
    user_assigned_resource_ids = [azurerm_user_assigned_identity.backup_vault_identity.id]
  }
}

# Backup Vault with Both System-Assigned and User-Assigned Identity
module "backup_vault_both_identities" {
  source = "../../"

  datastore_type      = "OperationalStore"
  location            = azurerm_resource_group.rg.location
  name                = "${module.naming.recovery_services_vault.name_unique}-both"
  redundancy          = "LocallyRedundant"
  resource_group_name = azurerm_resource_group.rg.name
  diagnostic_settings = {}
  enable_telemetry    = true
  # Both System-Assigned and User-Assigned Identity
  managed_identities = {
    system_assigned            = true
    user_assigned_resource_ids = [azurerm_user_assigned_identity.backup_vault_identity.id]
  }
}

```

<!-- markdownlint-disable MD033 -->
## Requirements

The following requirements are needed by this module:

- <a name="requirement_terraform"></a> [terraform](#requirement\_terraform) (>= 1.9, < 2.0)

- <a name="requirement_azapi"></a> [azapi](#requirement\_azapi) (~> 2.4)

- <a name="requirement_azurerm"></a> [azurerm](#requirement\_azurerm) (~> 4.0)

## Resources

The following resources are used by this module:

- [azurerm_resource_group.rg](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/resource_group) (resource)
- [azurerm_user_assigned_identity.backup_vault_identity](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/user_assigned_identity) (resource)

<!-- markdownlint-disable MD013 -->
## Required Inputs

No required inputs.

## Optional Inputs

No optional inputs.

## Outputs

The following outputs are exported:

### <a name="output_backup_vault_both_id"></a> [backup\_vault\_both\_id](#output\_backup\_vault\_both\_id)

Description: The ID of the Backup Vault with both System and User-Assigned Identities

### <a name="output_backup_vault_both_identity_principal_id"></a> [backup\_vault\_both\_identity\_principal\_id](#output\_backup\_vault\_both\_identity\_principal\_id)

Description: The System-Assigned Principal ID for the Both-Identity Backup Vault

### <a name="output_backup_vault_user_only_id"></a> [backup\_vault\_user\_only\_id](#output\_backup\_vault\_user\_only\_id)

Description: The ID of the Backup Vault with User-Assigned Identity only

### <a name="output_backup_vault_user_only_identity_principal_id"></a> [backup\_vault\_user\_only\_identity\_principal\_id](#output\_backup\_vault\_user\_only\_identity\_principal\_id)

Description: The Principal ID for the Identity of the User-Only Backup Vault (should be null since only user-assigned)

### <a name="output_user_assigned_identity_client_id"></a> [user\_assigned\_identity\_client\_id](#output\_user\_assigned\_identity\_client\_id)

Description: The Client ID of the User-Assigned Identity

### <a name="output_user_assigned_identity_id"></a> [user\_assigned\_identity\_id](#output\_user\_assigned\_identity\_id)

Description: The ID of the User-Assigned Identity created for the backup vault

### <a name="output_user_assigned_identity_principal_id"></a> [user\_assigned\_identity\_principal\_id](#output\_user\_assigned\_identity\_principal\_id)

Description: The Principal ID of the User-Assigned Identity

## Modules

The following Modules are called:

### <a name="module_backup_vault_both_identities"></a> [backup\_vault\_both\_identities](#module\_backup\_vault\_both\_identities)

Source: ../../

Version:

### <a name="module_backup_vault_user_assigned_only"></a> [backup\_vault\_user\_assigned\_only](#module\_backup\_vault\_user\_assigned\_only)

Source: ../../

Version:

### <a name="module_naming"></a> [naming](#module\_naming)

Source: Azure/naming/azurerm

Version: 0.3.0

## Notes

- The module fully supports SystemAssigned, UserAssigned, and both identity types
- User-assigned identities must be created before referencing them in the backup vault
- Multiple user-assigned identities can be assigned to a single backup vault
<!-- END_TF_DOCS -->
